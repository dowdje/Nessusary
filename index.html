<!DOCTYPE html>
<html>
<head>
  <title></title>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="tableSorter.js"></script>    
<script type="text/javascript" src="widgets.js"></script>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<nav>
<img id='logo' src="https://static.tenable.com/press/logos/products/NessusProfessional-White-RGB-logo.png">
<div id='status'></div>
</nav>
<div id='sub-nav'>
<div id='table-container'>
  <table id='table' class='tablesorter'>
    <thead>
    <tr id='table-headers'>
    <th id='name-header'>Name<i class="fa fa-sort" aria-hidden="true"></i></th>
    <th id='hostname-header'>Host<i class="fa fa-sort" aria-hidden="true"></i></th>         
    <th id='port-header'>Port<i class="fa fa-sort" aria-hidden="true"></i></th>
    <th id='username-header'>Username<i class="fa fa-sort" aria-hidden="true"></i></th>
    </tr>
    </thead>
    <tbody id='table-body'>

    </tbody>
  </table>
</div>
<div id='search-form'>
  <form onsubmit="getData()">
    <label>Host</label>
    <input type="text" name="host" id='host-input'>
    <label>Hostname</label>
    <input type="text" name="hostname" id='hostname-input'>
    <label>Port</label>
    <input type="text" name="port" id='hostname-input'>
    <input type="submit" name="submit" id='submit' >
  <!-- <button type="button" onclick="getData()">GET Data</button> -->
  </form>
</div>
</div>

</body>
<script>

function renderHostObjects(hosts){
hosts.forEach((host, idx)=>{
  var $table = $('#table-body');
  var $row = $('<tr/>', {class: 'row'}).appendTo($table)
  for(var key in host){
      $row.append($('<td/>',
        {class: key, text: host[key] }))
      }
  // zebraStripe($row)
  $("#table").trigger("update");
});
};
function getData() {
  event.preventDefault();
  var xhttp = new XMLHttpRequest();
  var targetUrl = "http://localhost:3000/download/request";
  
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("status").innerHTML = "";
      document.getElementById('table-body').innerHTML = "";

    document.getElementById("table").append("");
      const hosts = JSON.parse(this.responseText);
      renderHostObjects(hosts)
    }else if (this.status){
      document.getElementById("table-body").innerHTML = "Oops!";
  }else{
      document.getElementById("table-body").innerHTML = "Loading... ";
  }
  };
  
  xhttp.open("GET", targetUrl, true);
  xhttp.send();

}

$(document).ready(function() 
    { 
        $("#table").tablesorter({
          widgets:['zebra','resize'],    
          widgetOptions : {
            zebra : [ "normal-row", "alt-row" ]
            }
        }); 
    } 
); 
</script>
</html>